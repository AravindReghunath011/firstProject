<head>
    <style>
       body {
    background: #dedede;
}
.coupon .kanan {
    border-left: 1px dashed #ddd;
    width: 40% !important;
    position:relative;
}

.coupon .kanan .info::after, .coupon .kanan .info::before {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    background: #dedede;
    border-radius: 100%;
}
.coupon .kanan .info::before {
    top: -10px;
    left: -10px;
}

.coupon .kanan .info::after {
    bottom: -10px;
    left: -10px;
}
.coupon .time {
    font-size: 1.6rem;
}
        .icon-hover-primary:hover {
            border-color: #3b71ca !important;
            background-color: white !important;
        }

        .icon-hover-primary:hover i {
            color: #3b71ca !important;
        }

        .icon-hover-danger:hover {
            border-color: #dc4c64 !important;
            background-color: white !important;
        }

        .icon-hover-danger:hover i {
            color: #dc4c64 !important;
        }

        .boxed label {
            display: inline-block;
            width: 100%;
            margin-top: 20px;
            padding: 10px;
            border: solid 2px #ccc;
            transition: all 0.3s;
        }

        .boxed input[type="radio"] {
            display: none;
        }

        .boxed input[type="radio"]:checked+label {
            border: solid 2px rgb(15, 103, 218);
            background-color: #bad5ff;
        }

        :root {
            --card-line-height: 1.2em;
            --card-padding: 1em;
            --card-radius: 0.5em;
            --color-green: #558309;
            --color-gray: #e2ebf6;
            --color-dark-gray: #c4d1e1;
            --radio-border-width: 2px;
            --radio-size: 1.5em;
        }

        body {
            background-color: #f2f8ff;
            color: #263238;
            font-family: 'Noto Sans', sans-serif;
            margin: 0;
            padding: 2em 6vw;
        }

        .grid {
            display: grid;
            grid-gap: var(--card-padding);
            margin: 0 auto;
            max-width: 60em;
            padding: 0;

            @media (min-width: 42em) {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .card {
            background-color: #fff;
            border-radius: var(--card-radius);
            position: relative;

            &:hover {
                box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.15);
            }
        }

        .radio {
            font-size: inherit;
            margin: 0;
            position: absolute;
            right: calc(var(--card-padding) + var(--radio-border-width));
            top: calc(var(--card-padding) + var(--radio-border-width));
        }

        @supports(-webkit-appearance: none) or (-moz-appearance: none) {
            .radio {
                background: #fff;
                border: var(--radio-border-width) solid var(--color-gray);
                border-radius: 50%;
                cursor: pointer;
                height: var(--radio-size);
                outline: none;
                transition:
                    background 0.2s ease-out,
                    border-color 0.2s ease-out;
                width: var(--radio-size);

                &::after {
                    border: var(--radio-border-width) solid #fff;
                    border-top: 0;
                    border-left: 0;
                    content: '';
                    display: block;
                    height: 0.75rem;
                    left: 25%;
                    position: absolute;
                    top: 50%;
                    transform:
                        rotate(45deg) translate(-50%, -50%);
                    width: 0.375rem;
                }

                &:checked {
                    background: var(--color-green);
                    border-color: var(--color-green);
                }
            }

            .card:hover .radio {
                border-color: var(--color-dark-gray);

                &:checked {
                    border-color: var(--color-green);
                }
            }
        }

        .plan-details {
            border: var(--radio-border-width) solid var(--color-gray);
            border-radius: var(--card-radius);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            padding: var(--card-padding);
            transition: border-color 0.2s ease-out;
        }

        .card:hover .plan-details {
            border-color: var(--color-dark-gray);
        }

        .radio:checked~.plan-details {
            border-color: var(--color-green);
        }

        .radio:focus~.plan-details {
            box-shadow: 0 0 0 2px var(--color-dark-gray);
        }

        .radio:disabled~.plan-details {
            color: var(--color-dark-gray);
            cursor: default;
        }

        .radio:disabled~.plan-details .plan-type {
            color: var(--color-dark-gray);
        }

        .card:hover .radio:disabled~.plan-details {
            border-color: var(--color-gray);
            box-shadow: none;
        }

        .card:hover .radio:disabled {
            border-color: var(--color-gray);
        }

        .plan-type {
            color: var(--color-green);
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1em;
        }

        .plan-cost {
            font-size: 2.5rem;
            font-weight: bold;
            padding: 0.5rem 0;
        }

        .slash {
            font-weight: normal;
        }

        .plan-cycle {
            font-size: 2rem;
            font-variant: none;
            border-bottom: none;
            cursor: inherit;
            text-decoration: none;
        }

        .hidden-visually {
            border: 0;
            clip: rect(0, 0, 0, 0);
            height: 1px;
            margin: -1px;
            overflow: hidden;
            padding: 0;
            position: absolute;
            white-space: nowrap;
            width: 1px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.js"></script>
</head>
<!-- cart + summary -->
<section class="bg-light my-5">
    <div class="container">
        <div class="row">
            <!-- cart -->
            <div class="col-lg-9">
                <div class="card border shadow-0">
                    <div class="m-4">
                        <h1 style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                        font-weight: bolder;" class="card-title mb-4">
                            Select Address
                        </h1>
                        <a href="/addressFromPurchase" class="btn btn-info" style="margin-left: 35rem;">Add address</a>
                       

                        <form class="boxed" action="/buy" method="post">
                            <%for(i=0;i<userData.address.length;i++){%>
                                <input type="radio" required class="addressId" id="<%=userData.address[i]._id%>" checked
                                    name="address" required="true" value="<%=userData.address[i]._id%>">
                                <label for="<%=userData.address[i]._id%>" class="d-flex">
                                    <%=userData.address[i].name%><br>
                                        <%=userData.address[i].number%>
                                            <%=userData.address[i].altNumber%><br>
                                                <%=userData.address[i].pincode%><br>
                                                    <%=userData.address[i].house%>
                                                        <%=userData.address[i].landmark%>
                                                            <%=userData.address[i].town%>
                                                                <%=userData.address[i].state%>
                                                                    <%=userData.address[i].country%>
                                </label>
                                <%}%>
                                    <br><br>
                                    <h2>Select Payment method</h2>
                                    <div class="grid mb-4">

                                        <label class="card">
                                            <input name="paymentMethod" class="radio" type="radio" value="cod" checked>
                                            <span class="plan-details">
                                                <span class="plan-type">COD</span>
                                            </span>
                                        </label>
    
                                        <label class="card">
                                            <input name="paymentMethod" class="radio" type="radio" value="razorpay">
                                            <span class="plan-details">
                                                <span class="plan-type">Razorpay</span>
                                                
                                            </span>
                                        </label>
    
                                        <label class="card">
                                            <input disabled name="paymentMethod" class="radio" type="radio" value="paypal">
                                            <span class="plan-details">
                                                <span class="plan-type">Paypal</span>
                                                
                                            </span>
                                        </label>
    
                                    </div>
                                    <%if(from == 'cart'){%>
                                    <%for(i=0;i<productDetails.length;i++){%>

                                        <div class="d-flex mb-3 border border-success rounded p-3">
                                            <img class="img-fluid" width="100px"
                                                src="/upload/product/<%=productDetails[i].ProductDetails[0].images[0]%>"
                                                alt="Product-img">
                                            <p for="name" class="ms-4">
                                                <%=productDetails[i].ProductDetails[0].name%><br>
                                                    <s>₹<%=productDetails[i].ProductDetails[0].regularPrice%></s>
                                                    <b>₹<%=productDetails[i].ProductDetails[0].promotionalPrice%>
                                                            </b><br>
                                                    Quantity: <%=productDetails[i].quantity%>

                                            </p>
                                        </div>
                                        <%}%>
                                        <%}else{%>

                                           

                                                <div class="d-flex mb-3 border border-success rounded p-3">
                                                    <img class="img-fluid" width="100px"
                                                        src="/upload/product/<%=productDetails[0].images[0]%>"
                                                        alt="Product-img">
                                                    <p for="name" class="ms-4">
                                                        <%=productDetails[0].name%><br>
                                                            <s>₹<%=productDetails[0].regularPrice%></s>
                                                            <b>₹<%=productDetails[0].promotionalPrice%>
                                                                    </b><br>
                                                            Quantity: <%=productDetails[0].quantity%>
        
                                                    </p>
                                                </div>
                                              

                                            <%}%>


                                            
                        </form>
                    </div>
                </div>
            </div>
            <!-- cart -->
            <!-- summary -->
            <div class="col-lg-3">
                <div class="card mb-3 border shadow-0">
                    <div class="card-body">
                        <form>
                            <div class="form-group">
                                <label class="form-label">Have coupon?</label>
                                <div class="input-group">
                                    <input type="text" class="form-control border" id="couponCode" name="" placeholder="Coupon code" />
                                    <a onclick="applyCoupon()" id="apply"  class="btn btn-light border">Apply</a><br>
                                   
                                </div>
                            </div>
                            <div class="row">

                                <button type="button" class="btn btn-outline-primary mt-2" data-bs-toggle="modal"
              data-bs-target="#modalCoupon">Available Coupons</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="card shadow-0 border">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <p class="mb-2">Total price:</p>
                            <div class="d-flex">
                                &#8377;<p class="mb-2" id="GrandTotal">
                                    <%=GrandTotal%>
                                </p>
                            </div>
                           
                        </div>
                        <div class="d-flex justify-content-between">
                            <p class="mb-2" >Discount:</p>
                            <div class="d-flex"> 
                                - &#8377;<p class="mb-2 text-success" id="Discount">0</p>
                            </div>
                            
                        </div>
                       
                        <hr />
                        <div class="d-flex justify-content-between">
                            <p class="mb-2" >Total price:</p>
                            <div class="d-flex">
                                &#8377; <p class="mb-2 fw-bold" id="TotalPrice"> 
                                    <%=GrandTotal%>
                               </p>
                            </div>
                            
                        </div>

                        <div class="mt-3">
                            <%if(from=='productDetails'){%>
                            <a onclick="makePurchase('<%=productDetails[0]._id%>')" class="btn btn-success w-100 shadow-0 mb-2">
                                Make Purchase </a>
                                <%}else{%>
                                    <a onclick="makePurchase(0)" class="btn btn-success w-100 shadow-0 mb-2">
                                        Make Purchase </a>
                                <%}%>
                                <%if(userData.wallet <GrandTotal && userData.wallet != 0){%>
                                <a  onclick="useWallet()" class="btn btn-info w-100 walletButton"> use wallet</a>
                                    
                                    <%}%>
                                    <p style="display: none;" id="walletId"></p>
                                
                                
                            <a href="/productList" class="btn btn-light w-100 border mt-2"> Back to shop </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- summary -->
        </div>
    </div>
</section>
<!-- cart + summary -->


<section style="display: none;" id="coupon">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!------ Include the above in your HEAD tag ---------->
    
    <div class="container my-5">
        <div class="row">
            
            <div class="col-sm-6">
                <div class="coupon bg-white rounded mb-3 d-flex justify-content-between">
                    <div class="kiri p-3">
                        <div class="icon-container ">
                            <div class="icon-container_box">
                                <img src="data:image/png;base64,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" width="85" alt="totoprayogo.com" class="" />
                            </div>
                        </div>
                    </div>
                    <div class="tengah py-3 d-flex w-100 justify-content-start">
                        <div>
                            <span class="badge badge-success">Valid</span>
                            <h3 class="lead">Coupon Detail goes here </h3>
                            <p class="text-muted mb-0">Short info about voucher</p>
                        </div>
                    </div>
                    <div class="kanan">
                        <div class="info m-3 d-flex align-items-center">
                            <div class="w-100">
                                <div class="block">
                                    <span class="time font-weight-light">
                                        <span>19 days</span>
                                    </span>
                                </div>
                                <a href="https://www.totoprayogo.com" target="_blank" class="btn btn-sm btn-outline-danger btn-block">
                                    show
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- modal for coupon -->
<div class="modal fade top" id="modalCoupon" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true"
    data-bs-backdrop="true">
    <div class="modal-dialog modal-frame modal-top modal-notify modal-success" role="document">
      <!--Content-->
      <div class="modal-content">
        <!--Body-->
        <div class="modal-body">
          <% coupons.forEach((coupon, index)=> { %>
            <div class="row d-flex justify-content-center align-items-center border rounded">
              <div class="col-12 col-md-12 d-flex">
                <div class="code-container col-3 col-md-3 d-flex align-items-center">
                  <p>
                    <span class="badge" id="couponCode<%= index %>" style="color: black;">
                      <%= coupon.couponCode %>
                    </span>
                  </p>
                </div>
                <div class="content-copy-container col-9 col-md-9 d-flex align-items-center">
                  <p class="pt-3 mx-4">
                    
                      <strong> &#8377;<%= coupon.offerPrice %> discount</strong>.
                  </p>
                  <button type="button" class="btn btn-success copy-button ms-auto " data-index="<%= index %>">
                    <i class="fas fa-copy ml-1 white-text "></i>
                  </button>
                </div>
              </div>
            </div>
            <% }) %>
              <div class="close-container d-flex justify-content-end mt-2">
                <button type="button" class="btn btn-outline-success" data-bs-dismiss="modal">No, thanks</button>
              </div>
        </div>
      </div>
      <!--/.Content-->
    </div>
  </div>

  


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.js"></script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    function useWallet(){
      
        
            Swal.fire({
                imageUrl: '/wallet.jpg',
                imageAlt: 'wallet-img',
                showCloseButton: true,
                showCancelButton: true,
                html:
                '<h3>Wallet <b id="walletValue"><%=userData.wallet%></b></h3> ',
                confirmButtonText:
                    '<i class="fa fa-wallet"></i> Use wallet!',
            }).then((result)=>{
                if(result.isConfirmed){
                    
                    let TotalPrice = parseInt(document.getElementById('TotalPrice').innerHTML);
                   
                    let offer =  parseInt(document.getElementById('Discount').innerText )
                    
                    var wallet = parseInt('<%=userData.wallet%>')
                    
                    let discount = TotalPrice - wallet
                    

                    document.getElementById('Discount').innerText = wallet + offer
                    document.getElementById('TotalPrice').innerText = discount
                    document.getElementById('walletId').innerText = 'used'
                    document.getElementsByClassName('walletButton').style.display = 'none'
                    

                }
            })
        
    }
    function applyCoupon(){
        let couponCode = document.getElementById('couponCode').value
        let GrandTotal = document.getElementById('TotalPrice').innerText
       
        $.ajax({
            url:'/applyCoupon',
            method:'post',
            data:{
                couponCode:couponCode,
                GrandTotal:GrandTotal
            }, success: (response) => {
                if(response.status){
                    let discount =  parseInt(document.getElementById('Discount').innerText )
                    document.getElementById('TotalPrice').innerText  = response.GrandTotal
                    document.getElementById('Discount').innerText  = discount + response.offer
                    let couponCode = document.getElementById('couponCode')
                    couponCode.readOnly = true
                    let apply = document.getElementById('apply').disabled = true
                
                }else{
                    Swal.fire({
                        title: 'wrong CouponCode',
                        text: "There is no existing coupon",
                        icon: 'fail',
                        timer: 5000
                    })

                }
                
            }
        })
    }
    document.addEventListener("DOMContentLoaded", function () {
      const copyButtons = document.querySelectorAll(".copy-button");

      copyButtons.forEach(copyButton => {
        copyButton.addEventListener("click", function () {
          const couponCode = this.closest(".row").querySelector(".badge").textContent.trim();
          copyToClipboard(couponCode);
          updateCopyButton(this); 
          const modal = document.getElementById('modalCoupon');
          const modalInstance = bootstrap.Modal.getInstance(modal);
          modalInstance.hide(); // Close the modal after copying
        });
      });
    });

    function updateCopyButton(button) {
      button.innerHTML = '<i class="fas fa-check ml-1 white-text"></i>';
      button.disabled = true; // Disable the button after copying
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
      } catch (error) {
        console.error("Failed to copy:", error);
      }
    }

    function makePurchase(id) {
       
        
      
        let GrandTotal = document.getElementById('TotalPrice').innerText
       GrandTotal = parseInt(GrandTotal)
       let addressId = $(".addressId:checked").val();
      
       let isWalletUsed = document.getElementById('walletId').innerText
       let payment = $(".radio:checked").val();
       let discount = '<%=userData.wallet%>'
       let Discount = document.getElementById('Discount').innerText
       Discount = parseInt(Discount)

        $.ajax({
            url: '/makePurchase',
            method: 'post',
            data: {
                addressId: addressId,
                payment: payment,
                GrandTotal: GrandTotal,
                id:id,
                Discount:Discount,
                isWalletUsed:isWalletUsed

            }, success: (response) => {
               
                if(response.status==false){
                    Swal.fire({
                            title: 'Error!!',
                            text: 'error occured',
                            icon: 'error',
                            timer: 5000
                        }) 
                }else if(response.status == 'outOfStock'){
                    Swal.fire({
                        title: 'Stock!!',
                        text: "the products is out of stock",
                        icon: 'fail',
                        timer: 5000
                    })
                }else if (response.status == 'cod') {
                    Swal.fire({
                        title: "Order success",
                        text: "order placed successfully",
                        icon: "success",
                        showCancelButton: true,
                        confirmButtonText: "view orders",
                        cancelButtonText: "continue shopping",
                        reverseButtons: true
                    }).then(function (result) {
                        if (result.value) {
                            location.href = '/orderDetails?id='+response.id
                            // result.dismiss can be "cancel", "overlay",
                            // "close", and "timer"
                        } else if (result.dismiss === "cancel") {
                            location.href = '/productList'
                        }
                    });

                }else if(response.status == 'razorpay'){
                    
                    var options = {
                            "key": "rzp_test_sPwoxcRC0hnSFO", // Enter the Key ID generated from the Dashboard
                            "amount": response.order.GrandTotal, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                            "currency": "INR",
                            "name": "Future Furniture", //your business name
                            "description": "Test Transaction",
                            "image": "https://example.com/your_logo",
                            "order_id": response.order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                            "handler": function (status){
                                
                                verifyPayment(response.order,status,response.id)
                            },
                            "prefill": { //We recommend using the prefill parameter to auto-fill customer's contact information, especially their phone number
                                "name": "Gaurav Kumar", //your customer's name
                                "email": "gaurav.kumar@example.com", 
                                "contact": "9000090000"  //Provide the customer's phone number for better conversion rates 
                            },
                            "notes": {
                                "address": "Razorpay Corporate Office"
                            },
                            "theme": {
                                "color": "#3399cc"
                            }
                        };
                        var rzp1 = new Razorpay(options);
                        rzp1.open();


                }else {
                    alert('error')
                }
            }
        })
    }

    function verifyPayment(order,payment,id){
        $.ajax({
            url:'/verifyPayment',
            method:'post',
            data:{
                order,
                payment
            },success:(response)=>{
                
                if(response.status){
                    Swal.fire({
                        title: "Order success",
                        text: "order placed successfully",
                        icon: "success",
                        showCancelButton: true,
                        confirmButtonText: "view orders",
                        cancelButtonText: "continue shopping",
                        reverseButtons: true
                    }).then(function (result) {
                        if (result.value) {
                            
                            location.href = '/orderDetails?id='+id
                            // result.dismiss can be "cancel", "overlay",
                            // "close", and "timer"
                        } else if (result.dismiss === "cancel") {
                            location.href = '/productList'
                        }
                    });
                }

            }
        })
    }
</script>